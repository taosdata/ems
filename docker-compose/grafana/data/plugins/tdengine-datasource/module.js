/* [create-plugin] version: 5.9.2 */
define(["@grafana/data","@grafana/runtime","@grafana/ui","lodash","module","moment","react"],((e,t,r,a,o,n,i)=>(()=>{"use strict";var s={98:(e,t,r)=>{r.d(t,{A:()=>s});var a=r(942),o=r.n(a),n=r(278),i=r.n(n)()(o());i.push([e.id,".align-center{\n    align-items: center;\n}\n.switch-wrapper {\n    border: 1px solid #f6f3f3;\n    padding: 5px;\n}\n\n.custom-button {\n    background-color: #d10e5c; /* Button background color */\n    color: white; /* text color */\n    border: none;\n    padding: 8px 16px; /* Inner margin adjustment button size */\n    border-radius: 2px; /* Set a larger fillet radius close to an ellipse */\n    cursor: pointer;\n    transition: background-color 0.3s ease; /* Transition effect makes interaction smoother */\n    font-size: 14px; /* font size */\n    text-transform: uppercase; /* capital letter */\n    letter-spacing: 1px; /* letter-spacing */\n    height: 20px; /* Set button height */\n    width: 10px; /* Set button width */\n}\n.custom-button:hover {\n    background-color: #eb0637; /* Background color when hovering */\n    color: white; /* Text color when hovering */\n}\n\n","",{version:3,sources:["webpack://./components/ConfigEditor/ConfigEditor.css"],names:[],mappings:"AAAA;IACI,mBAAmB;AACvB;AACA;IACI,yBAAyB;IACzB,YAAY;AAChB;;AAEA;IACI,yBAAyB,EAAE,4BAA4B;IACvD,YAAY,EAAE,eAAe;IAC7B,YAAY;IACZ,iBAAiB,EAAE,wCAAwC;IAC3D,kBAAkB,EAAE,mDAAmD;IACvE,eAAe;IACf,sCAAsC,EAAE,iDAAiD;IACzF,eAAe,EAAE,cAAc;IAC/B,yBAAyB,EAAE,mBAAmB;IAC9C,mBAAmB,EAAE,mBAAmB;IACxC,YAAY,EAAE,sBAAsB;IACpC,WAAW,EAAE,qBAAqB;AACtC;AACA;IACI,yBAAyB,EAAE,mCAAmC;IAC9D,YAAY,EAAE,6BAA6B;AAC/C",sourcesContent:[".align-center{\n    align-items: center;\n}\n.switch-wrapper {\n    border: 1px solid #f6f3f3;\n    padding: 5px;\n}\n\n.custom-button {\n    background-color: #d10e5c; /* Button background color */\n    color: white; /* text color */\n    border: none;\n    padding: 8px 16px; /* Inner margin adjustment button size */\n    border-radius: 2px; /* Set a larger fillet radius close to an ellipse */\n    cursor: pointer;\n    transition: background-color 0.3s ease; /* Transition effect makes interaction smoother */\n    font-size: 14px; /* font size */\n    text-transform: uppercase; /* capital letter */\n    letter-spacing: 1px; /* letter-spacing */\n    height: 20px; /* Set button height */\n    width: 10px; /* Set button width */\n}\n.custom-button:hover {\n    background-color: #eb0637; /* Background color when hovering */\n    color: white; /* Text color when hovering */\n}\n\n"],sourceRoot:""}]);const s=i},278:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var r="",a=void 0!==t[5];return t[4]&&(r+="@supports (".concat(t[4],") {")),t[2]&&(r+="@media ".concat(t[2]," {")),a&&(r+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),r+=e(t),a&&(r+="}"),t[2]&&(r+="}"),t[4]&&(r+="}"),r})).join("")},t.i=function(e,r,a,o,n){"string"==typeof e&&(e=[[null,e,void 0]]);var i={};if(a)for(var s=0;s<this.length;s++){var l=this[s][0];null!=l&&(i[l]=!0)}for(var u=0;u<e.length;u++){var c=[].concat(e[u]);a&&i[c[0]]||(void 0!==n&&(void 0===c[5]||(c[1]="@layer".concat(c[5].length>0?" ".concat(c[5]):""," {").concat(c[1],"}")),c[5]=n),r&&(c[2]?(c[1]="@media ".concat(c[2]," {").concat(c[1],"}"),c[2]=r):c[2]=r),o&&(c[4]?(c[1]="@supports (".concat(c[4],") {").concat(c[1],"}"),c[4]=o):c[4]="".concat(o)),t.push(c))}},t}},942:e=>{e.exports=function(e){var t=e[1],r=e[3];if(!r)return t;if("function"==typeof btoa){var a=btoa(unescape(encodeURIComponent(JSON.stringify(r)))),o="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(a),n="/*# ".concat(o," */");return[t].concat([n]).join("\n")}return[t].join("\n")}},292:e=>{var t=[];function r(e){for(var r=-1,a=0;a<t.length;a++)if(t[a].identifier===e){r=a;break}return r}function a(e,a){for(var n={},i=[],s=0;s<e.length;s++){var l=e[s],u=a.base?l[0]+a.base:l[0],c=n[u]||0,d="".concat(u," ").concat(c);n[u]=c+1;var p=r(d),m={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==p)t[p].references++,t[p].updater(m);else{var f=o(m,a);a.byIndex=s,t.splice(s,0,{identifier:d,updater:f,references:1})}i.push(d)}return i}function o(e,t){var r=t.domAPI(t);r.update(e);return function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;r.update(e=t)}else r.remove()}}e.exports=function(e,o){var n=a(e=e||[],o=o||{});return function(e){e=e||[];for(var i=0;i<n.length;i++){var s=r(n[i]);t[s].references--}for(var l=a(e,o),u=0;u<n.length;u++){var c=r(n[u]);0===t[c].references&&(t[c].updater(),t.splice(c,1))}n=l}}},383:e=>{var t={};e.exports=function(e,r){var a=function(e){if(void 0===t[e]){var r=document.querySelector(e);if(window.HTMLIFrameElement&&r instanceof window.HTMLIFrameElement)try{r=r.contentDocument.head}catch(e){r=null}t[e]=r}return t[e]}(e);if(!a)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");a.appendChild(r)}},88:e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},884:(e,t,r)=>{e.exports=function(e){var t=r.nc;t&&e.setAttribute("nonce",t)}},893:e=>{e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(r){!function(e,t,r){var a="";r.supports&&(a+="@supports (".concat(r.supports,") {")),r.media&&(a+="@media ".concat(r.media," {"));var o=void 0!==r.layer;o&&(a+="@layer".concat(r.layer.length>0?" ".concat(r.layer):""," {")),a+=r.css,o&&(a+="}"),r.media&&(a+="}"),r.supports&&(a+="}");var n=r.sourceMap;n&&"undefined"!=typeof btoa&&(a+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(n))))," */")),t.styleTagTransform(a,e,t.options)}(t,e,r)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},997:e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},781:t=>{t.exports=e},531:e=>{e.exports=t},7:e=>{e.exports=r},241:e=>{e.exports=a},308:e=>{e.exports=o},468:e=>{e.exports=n},959:e=>{e.exports=i}},l={};function u(e){var t=l[e];if(void 0!==t)return t.exports;var r=l[e]={id:e,exports:{}};return s[e](r,r.exports,u),r.exports}u.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return u.d(t,{a:t}),t},u.d=(e,t)=>{for(var r in t)u.o(t,r)&&!u.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},u.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),u.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},u.p="public/plugins/tdengine-datasource/",u.nc=void 0;var c={};u.r(c),u.d(c,{plugin:()=>_e});var d=u(308),p=u.n(d);u.p=p()&&p().uri?p().uri.slice(0,p().uri.lastIndexOf("/")+1):"public/plugins/tdengine-datasource/";var m=u(781),f=u(531),y=u(241),g=u.n(y),h=u(468),_=u.n(h);const b=JSON.parse('{"uy":{"title":"alert_24h","folderUid":"fdvz0sywic3r4c","interval":86400,"rules":[{"orgID":1,"folderUID":"fdvz0sywic3r4c","ruleGroup":"alert_24h","title":"Expire Time Alert","condition":"B","data":[{"refId":"A","queryType":"SQL","relativeTimeRange":{"from":172800,"to":0},"datasourceUid":"eduofcpsbaqkgb","model":{"colNameFormatStr":"","colNameToGroup":"cluster_id","datasource":{"type":"tdengine-datasource","uid":"eduofcpsbaqkgb"},"formatType":"Time series","intervalMs":86400000,"maxDataPoints":43200,"queryType":"SQL","refId":"A","sql":"select now(), cluster_id, last(grants_expire_time) / 86400 as expire_time from log.taosd_cluster_info where  _ts >= (now - 24h)  and _ts < now  partition by cluster_id having first(_ts) > 0 ","timeShiftPeriod":""}},{"refId":"B","queryType":"","relativeTimeRange":{"from":600,"to":0},"datasourceUid":"__expr__","model":{"conditions":[{"evaluator":{"params":[60,0],"type":"lt"},"operator":{"type":"and"},"query":{"params":["A"]},"reducer":{"params":[],"type":"max"},"type":"query"}],"datasource":{"name":"Expression","type":"__expr__","uid":"__expr__"},"expression":"","intervalMs":1000,"maxDataPoints":43200,"refId":"B","type":"classic_conditions"}}],"noDataState":"Alerting","execErrState":"Alerting","for":"0s","annotations":{"description":"detailed information：{{ .Value }}","summary":"Authorization is about to expire"},"isPaused":false},{"orgID":1,"folderUID":"fdvz0sywic3r4c","ruleGroup":"alert_24h","title":"Used Measuring Points alert","condition":"B","data":[{"refId":"A","queryType":"SQL","relativeTimeRange":{"from":172800,"to":0},"datasourceUid":"eduofcpsbaqkgb","model":{"colNameFormatStr":"","colNameToGroup":"cluster_id","datasource":{"type":"tdengine-datasource","uid":"eduofcpsbaqkgb"},"formatType":"Time series","intervalMs":86400000,"maxDataPoints":43200,"queryType":"SQL","refId":"A","sql":" select now(), cluster_id, CASE WHEN max(grants_timeseries_total) > 0.0 THEN max(grants_timeseries_used) / max(grants_timeseries_total) * 100.0 ELSE 0.0 END AS result from log.taosd_cluster_info where _ts >= (now - 30s) and _ts < now partition by cluster_id having timetruncate(first(_ts), 1m) > 0 ","timeShiftPeriod":""}},{"refId":"B","queryType":"","relativeTimeRange":{"from":600,"to":0},"datasourceUid":"__expr__","model":{"conditions":[{"evaluator":{"params":[90,0],"type":"gt"},"operator":{"type":"and"},"query":{"params":["A"]},"reducer":{"params":[],"type":"max"},"type":"query"}],"datasource":{"name":"Expression","type":"__expr__","uid":"__expr__"},"expression":"","intervalMs":1000,"maxDataPoints":43200,"refId":"B","type":"classic_conditions"}}],"noDataState":"Alerting","execErrState":"Alerting","for":"0s","annotations":{"description":"detailed information：{{ .Value }}","summary":"Used Measuring Points above 90%"},"isPaused":false}]},"op":{"title":"alert_5m","folderUid":"fdvz0sywic3r4c","interval":300,"rules":[{"orgID":1,"folderUID":"fdvz0sywic3r4c","ruleGroup":"alert_5m","title":"CPU Usage alert","condition":"B","data":[{"refId":"A","queryType":"SQL","relativeTimeRange":{"from":3600,"to":0},"datasourceUid":"eduofcpsbaqkgb","model":{"colNameFormatStr":"","colNameToGroup":"dnode_ep","datasource":{"type":"tdengine-datasource","uid":"eduofcpsbaqkgb"},"formatType":"Time series","intervalMs":30000,"maxDataPoints":43200,"queryType":"SQL","refId":"A","sql":"select now(), dnode_ep, last(cpu_system) as cpu_use from log.taosd_dnodes_info where _ts >= (now- 5m) and _ts < now partition by dnode_ep ","timeShiftPeriod":""}},{"refId":"B","queryType":"","relativeTimeRange":{"from":600,"to":0},"datasourceUid":"__expr__","model":{"conditions":[{"evaluator":{"params":[80,0],"type":"gt"},"operator":{"type":"and"},"query":{"params":["A"]},"reducer":{"params":[],"type":"max"},"type":"query"}],"datasource":{"name":"Expression","type":"__expr__","uid":"__expr__"},"expression":"","intervalMs":1000,"maxDataPoints":43200,"refId":"B","type":"classic_conditions"}}],"noDataState":"Alerting","execErrState":"Alerting","for":"5m","annotations":{"description":"detailed information：{{ .Value }}","summary":"Node CPU usage exceeds 80%"},"isPaused":false},{"orgID":1,"folderUID":"fdvz0sywic3r4c","ruleGroup":"alert_5m","title":"RAM Usage alert","condition":"B","data":[{"refId":"A","queryType":"SQL","relativeTimeRange":{"from":3600,"to":0},"datasourceUid":"eduofcpsbaqkgb","model":{"colNameFormatStr":"","colNameToGroup":"dnode_ep","datasource":{"type":"tdengine-datasource","uid":"eduofcpsbaqkgb"},"formatType":"Time series","intervalMs":30000,"maxDataPoints":43200,"queryType":"SQL","refId":"A","sql":"select now(), dnode_ep, last(mem_engine) / last(mem_total)  * 100 as taosd from log.taosd_dnodes_info where _ts >= (now- 5m) and _ts <now partition by dnode_ep","timeShiftPeriod":""}},{"refId":"B","queryType":"","relativeTimeRange":{"from":600,"to":0},"datasourceUid":"__expr__","model":{"conditions":[{"evaluator":{"params":[60,0],"type":"gt"},"operator":{"type":"and"},"query":{"params":["A"]},"reducer":{"params":[],"type":"max"},"type":"query"}],"datasource":{"name":"Expression","type":"__expr__","uid":"__expr__"},"expression":"","intervalMs":1000,"maxDataPoints":43200,"refId":"B","type":"classic_conditions"}}],"noDataState":"Alerting","execErrState":"Alerting","for":"5m","annotations":{"description":"detailed information：{{ .Value }}","summary":"Node RAM usage exceeds 60%"},"isPaused":false},{"orgID":1,"folderUID":"fdvz0sywic3r4c","ruleGroup":"alert_5m","title":"Disk Used Rate alert","condition":"B","data":[{"refId":"A","queryType":"SQL","relativeTimeRange":{"from":3600,"to":0},"datasourceUid":"eduofcpsbaqkgb","model":{"colNameFormatStr":"","colNameToGroup":"dnode_ep, data_dir_level, data_dir_name","datasource":{"type":"tdengine-datasource","uid":"eduofcpsbaqkgb"},"formatType":"Time series","intervalMs":30000,"maxDataPoints":43200,"queryType":"SQL","refId":"A","sql":"select now(), dnode_ep, data_dir_level, data_dir_name, last(used)  / last(total)  * 100 as used from log.taosd_dnodes_data_dirs where _ts >= (now - 5m) and _ts < now partition by dnode_ep, data_dir_level, data_dir_name ","timeShiftPeriod":""}},{"refId":"B","queryType":"","relativeTimeRange":{"from":600,"to":0},"datasourceUid":"__expr__","model":{"conditions":[{"evaluator":{"params":[80,0],"type":"gt"},"operator":{"type":"and"},"query":{"params":["A"]},"reducer":{"params":[],"type":"max"},"type":"query"}],"datasource":{"name":"Expression","type":"__expr__","uid":"__expr__"},"expression":"","intervalMs":1000,"maxDataPoints":43200,"refId":"B","type":"classic_conditions"}}],"noDataState":"Alerting","execErrState":"Alerting","for":"5m","annotations":{"description":"detailed information：{{ .Value }}","summary":"Disk Used above 80%"},"isPaused":false}]},"yB":{"title":"alert_30s","folderUid":"fdvz0sywic3r4c","interval":30,"rules":[{"orgID":1,"folderUID":"fdvz0sywic3r4c","ruleGroup":"alert_30s","title":"DNodes offline alert","condition":"B","data":[{"refId":"A","queryType":"SQL","relativeTimeRange":{"from":600,"to":0},"datasourceUid":"eduofcpsbaqkgb","model":{"colNameFormatStr":"","colNameToGroup":"cluster_id","datasource":{"type":"tdengine-datasource","uid":"eduofcpsbaqkgb"},"formatType":"Time series","intervalMs":1000,"maxDataPoints":43200,"queryType":"SQL","refId":"A","sql":"select now(), cluster_id, last(dnodes_total)  - last(dnodes_alive) as dnode_offline  from log.taosd_cluster_info where _ts >= (now -30s) and _ts < now partition by cluster_id having first(_ts) > 0","timeShiftPeriod":""}},{"refId":"B","queryType":"","relativeTimeRange":{"from":600,"to":0},"datasourceUid":"__expr__","model":{"conditions":[{"evaluator":{"params":[0,0],"type":"gt"},"operator":{"type":"and"},"query":{"params":["A"]},"reducer":{"params":[],"type":"max"},"type":"query"}],"datasource":{"name":"Expression","type":"__expr__","uid":"__expr__"},"expression":"","intervalMs":1000,"maxDataPoints":43200,"refId":"B","type":"classic_conditions"}}],"noDataState":"Alerting","execErrState":"Alerting","for":"0s","annotations":{"description":"detailed information：{{ .Value }}","summary":"There are nodes offline in the cluster"},"isPaused":false},{"orgID":1,"folderUID":"fdvz0sywic3r4c","ruleGroup":"alert_30s","title":"VNodes Offline alert","condition":"B","data":[{"refId":"A","queryType":"SQL","relativeTimeRange":{"from":600,"to":0},"datasourceUid":"eduofcpsbaqkgb","model":{"colNameFormatStr":"","colNameToGroup":"cluster_id","datasource":{"type":"tdengine-datasource","uid":"eduofcpsbaqkgb"},"formatType":"Time series","intervalMs":1000,"maxDataPoints":43200,"queryType":"SQL","refId":"A","sql":"select now(), cluster_id, last(vnodes_total)  - last(vnodes_alive) as vnode_offline  from log.taosd_cluster_info where _ts >= (now - 30s) and _ts < now partition by cluster_id having first(_ts) > 0","timeShiftPeriod":""}},{"refId":"B","queryType":"","relativeTimeRange":{"from":600,"to":0},"datasourceUid":"__expr__","model":{"conditions":[{"evaluator":{"params":[0,0],"type":"gt"},"operator":{"type":"and"},"query":{"params":["A"]},"reducer":{"params":[],"type":"max"},"type":"query"}],"datasource":{"name":"Expression","type":"__expr__","uid":"__expr__"},"expression":"","intervalMs":1000,"maxDataPoints":43200,"refId":"B","type":"classic_conditions"}}],"noDataState":"Alerting","execErrState":"Alerting","for":"0s","annotations":{"description":"detailed information：{{ .Value }}","summary":"There are vnodes offline in the cluster"},"isPaused":false},{"orgID":1,"folderUID":"fdvz0sywic3r4c","ruleGroup":"alert_30s","title":"Delete Request Alert","condition":"B","data":[{"refId":"A","queryType":"SQL","relativeTimeRange":{"from":600,"to":0},"datasourceUid":"eduofcpsbaqkgb","model":{"colNameFormatStr":"","colNameToGroup":"","datasource":{"type":"tdengine-datasource","uid":"eduofcpsbaqkgb"},"formatType":"Time series","intervalMs":1000,"maxDataPoints":43200,"queryType":"SQL","refId":"A","sql":"select now(), sum(`count`)  as `delete_count`  from log.taos_sql_req  where sql_type = \'delete\' and _ts >= (now -30s) and _ts < now","timeShiftPeriod":""}},{"refId":"B","queryType":"","relativeTimeRange":{"from":600,"to":0},"datasourceUid":"__expr__","model":{"conditions":[{"evaluator":{"params":[0,0],"type":"gt"},"operator":{"type":"and"},"query":{"params":["A"]},"reducer":{"params":[],"type":"max"},"type":"query"}],"datasource":{"name":"Expression","type":"__expr__","uid":"__expr__"},"expression":"","intervalMs":1000,"maxDataPoints":43200,"refId":"B","type":"classic_conditions"}}],"noDataState":"OK","execErrState":"Alerting","for":"0s","annotations":{"description":"detailed information：{{ .Value }}","summary":"Received data deletion request within 30 seconds"},"isPaused":false},{"orgID":1,"folderUID":"fdvz0sywic3r4c","ruleGroup":"alert_30s","title":"Adapter Websocket Failed Alert","condition":"B","data":[{"refId":"A","queryType":"SQL","relativeTimeRange":{"from":600,"to":0},"datasourceUid":"eduofcpsbaqkgb","model":{"colNameFormatStr":"","colNameToGroup":"","datasource":{"type":"tdengine-datasource","uid":"eduofcpsbaqkgb"},"formatType":"Time series","intervalMs":1000,"maxDataPoints":43200,"queryType":"SQL","refId":"A","sql":"select now(), sum(`fail`) as `Failed` from log.adapter_requests where req_type=1 and ts >= (now -30s) and ts < now","timeShiftPeriod":""}},{"refId":"B","queryType":"","relativeTimeRange":{"from":600,"to":0},"datasourceUid":"__expr__","model":{"conditions":[{"evaluator":{"params":[5,0],"type":"gt"},"operator":{"type":"and"},"query":{"params":["A"]},"reducer":{"params":[],"type":"max"},"type":"query"}],"datasource":{"name":"Expression","type":"__expr__","uid":"__expr__"},"expression":"","intervalMs":1000,"maxDataPoints":43200,"refId":"B","type":"classic_conditions"}}],"noDataState":"OK","execErrState":"Alerting","for":"0s","annotations":{"description":"detailed information：{{ .Value }}","summary":"The adapter websocket interface has failed more than 5 times within 30 seconds"},"isPaused":false},{"orgID":1,"folderUID":"fdvz0sywic3r4c","ruleGroup":"alert_30s","title":"Adapter RESTful Failed Alert alert","condition":"B","data":[{"refId":"A","queryType":"SQL","relativeTimeRange":{"from":600,"to":0},"datasourceUid":"eduofcpsbaqkgb","model":{"colNameFormatStr":"","colNameToGroup":"","datasource":{"type":"tdengine-datasource","uid":"eduofcpsbaqkgb"},"formatType":"Time series","intervalMs":1000,"maxDataPoints":43200,"queryType":"SQL","refId":"A","sql":"select now(), sum(`fail`) as `Failed` from log.adapter_requests where req_type=0 and ts >= (now -30s) and ts < now;","timeShiftPeriod":""}},{"refId":"B","queryType":"","relativeTimeRange":{"from":600,"to":0},"datasourceUid":"__expr__","model":{"conditions":[{"evaluator":{"params":[5,0],"type":"gt"},"operator":{"type":"and"},"query":{"params":["A"]},"reducer":{"params":[],"type":"max"},"type":"query"}],"datasource":{"name":"Expression","type":"__expr__","uid":"__expr__"},"expression":"","intervalMs":1000,"maxDataPoints":43200,"refId":"B","type":"classic_conditions"}}],"noDataState":"OK","execErrState":"Alerting","for":"0s","annotations":{"description":"detailed information：{{ .Value }}","summary":"The adapter restful interface has failed more than 5 times within 30 seconds"},"isPaused":false}]},"s7":{"title":"alert_1m","folderUid":"fdvz0sywic3r4c","interval":60,"rules":[{"orgID":1,"folderUID":"fdvz0sywic3r4c","ruleGroup":"alert_1m","title":"Query Count Alert","condition":"B","data":[{"refId":"A","queryType":"SQL","relativeTimeRange":{"from":600,"to":0},"datasourceUid":"eduofcpsbaqkgb","model":{"colNameFormatStr":"","colNameToGroup":"","datasource":{"type":"tdengine-datasource","uid":"eduofcpsbaqkgb"},"formatType":"Time series","intervalMs":1000,"maxDataPoints":43200,"queryType":"SQL","refId":"A","sql":"select now() as ts, count(*) as slow_count from performance_schema.perf_queries","timeShiftPeriod":""}},{"refId":"B","queryType":"","relativeTimeRange":{"from":600,"to":0},"datasourceUid":"__expr__","model":{"conditions":[{"evaluator":{"params":[100,0],"type":"gt"},"operator":{"type":"and"},"query":{"params":["A"]},"reducer":{"params":[],"type":"max"},"type":"query"}],"datasource":{"name":"Expression","type":"__expr__","uid":"__expr__"},"expression":"","intervalMs":1000,"maxDataPoints":43200,"refId":"B","type":"classic_conditions"}}],"noDataState":"OK","execErrState":"Alerting","for":"0s","annotations":{"description":"detailed information：{{ .Value }}","summary":"The number of query requests exceeds 100 times within one minute"},"isPaused":false},{"orgID":1,"folderUID":"fdvz0sywic3r4c","ruleGroup":"alert_1m","title":"Slow Query Alert alert","condition":"B","data":[{"refId":"A","queryType":"SQL","relativeTimeRange":{"from":600,"to":0},"datasourceUid":"eduofcpsbaqkgb","model":{"colNameFormatStr":"","colNameToGroup":"","datasource":{"type":"tdengine-datasource","uid":"eduofcpsbaqkgb"},"formatType":"Time series","intervalMs":1000,"maxDataPoints":43200,"queryType":"SQL","refId":"A","sql":"select now() as ts, count(*) as slow_count from performance_schema.perf_queries where exec_usec>300000000","timeShiftPeriod":""}},{"refId":"B","queryType":"","relativeTimeRange":{"from":600,"to":0},"datasourceUid":"__expr__","model":{"conditions":[{"evaluator":{"params":[0,0],"type":"gt"},"operator":{"type":"and"},"query":{"params":["A"]},"reducer":{"params":[],"type":"max"},"type":"query"}],"datasource":{"name":"Expression","type":"__expr__","uid":"__expr__"},"expression":"","intervalMs":1000,"maxDataPoints":43200,"refId":"B","type":"classic_conditions"}}],"noDataState":"OK","execErrState":"Alerting","for":"0s","annotations":{"description":"detailed information：{{ .Value }}","summary":"Query duration exceeds 300 seconds"},"isPaused":false}]},"ez":{"title":"alert_180s","folderUid":"fdvz0sywic3r4c","interval":180,"rules":[{"orgID":1,"folderUID":"fdvz0sywic3r4c","ruleGroup":"alert_180s","title":"DNodes report alert","condition":"B","data":[{"refId":"A","queryType":"SQL","relativeTimeRange":{"from":3600,"to":0},"datasourceUid":"eduofcpsbaqkgb","model":{"colNameFormatStr":"","colNameToGroup":"cluster_id","datasource":{"type":"tdengine-datasource","uid":"eduofcpsbaqkgb"},"formatType":"Time series","intervalMs":1000,"maxDataPoints":43200,"queryType":"SQL","refId":"A","sql":"select now(), cluster_id, count(*) as dnode_report  from log.taosd_cluster_info where _ts >= (now -180s) and _ts < now  partition by cluster_id having timetruncate(first(_ts), 1h) > 0","timeShiftPeriod":""}},{"refId":"B","queryType":"","relativeTimeRange":{"from":600,"to":0},"datasourceUid":"__expr__","model":{"conditions":[{"evaluator":{"params":[3,0],"type":"lt"},"operator":{"type":"and"},"query":{"params":["A"]},"reducer":{"params":[],"type":"min"},"type":"query"}],"datasource":{"name":"Expression","type":"__expr__","uid":"__expr__"},"expression":"","intervalMs":1000,"maxDataPoints":43200,"refId":"B","type":"classic_conditions"}}],"noDataState":"Alerting","execErrState":"Alerting","for":"0s","annotations":{"description":"detailed information：{{ .Value }}","summary":"DNodes Metrics reports less than 3 times within 180 seconds"},"isPaused":false}]},"AX":{"title":"alert_90s","folderUid":"fdvz0sywic3r4c","interval":90,"rules":[{"orgID":1,"folderUID":"fdvz0sywic3r4c","ruleGroup":"alert_90s","title":"Dnodes reboot alert","condition":"B","data":[{"refId":"A","queryType":"SQL","relativeTimeRange":{"from":3600,"to":0},"datasourceUid":"eduofcpsbaqkgb","model":{"colNameFormatStr":"","colNameToGroup":"dnode_ep","datasource":{"type":"tdengine-datasource","uid":"eduofcpsbaqkgb"},"formatType":"Time series","intervalMs":1000,"maxDataPoints":43200,"queryType":"SQL","refId":"A","sql":"select now(), dnode_ep,  max(uptime) - last(uptime) as dnode_report  from log.taosd_dnodes_info where _ts >= (now - 90s) and _ts < now  partition by dnode_ep","timeShiftPeriod":""}},{"refId":"B","queryType":"","relativeTimeRange":{"from":600,"to":0},"datasourceUid":"__expr__","model":{"conditions":[{"evaluator":{"params":[0,0],"type":"gt"},"operator":{"type":"and"},"query":{"params":["A"]},"reducer":{"params":[],"type":"max"},"type":"query"}],"datasource":{"name":"Expression","type":"__expr__","uid":"__expr__"},"expression":"","intervalMs":1000,"maxDataPoints":43200,"refId":"B","type":"classic_conditions"}}],"noDataState":"Alerting","execErrState":"Alerting","for":"0s","annotations":{"description":"detailed information：{{ .Value }}","summary":"Dnodes restart"},"isPaused":false}]}}');function v(e,t,r,a,o,n,i){try{var s=e[n](i),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(a,o)}function A(e){return function(){var t=this,r=arguments;return new Promise((function(a,o){var n=e.apply(t,r);function i(e){v(n,a,o,i,s,"next",e)}function s(e){v(n,a,o,i,s,"throw",e)}i(void 0)}))}}function w(){return w=A((function*(e){try{let t=T(e);yield S("alert_1m",t),yield S("alert_5m",t),yield S("alert_30s",t),yield S("alert_90s",t),yield S("alert_180s",t),yield S("alert_24h",t),yield function(e){return x.apply(this,arguments)}(t)}catch(e){throw console.error("Error in async function:",e),e}})),w.apply(this,arguments)}function S(e,t){return new Promise(function(){var r=A((function*(r,a){let o=`/api/v1/provisioning/folder/${t}/rule-groups/${e}`;(0,f.getBackendSrv)().delete(o,{},{responseType:"text",showErrorAlert:!1}).then((e=>{r(!0)})).catch((e=>{console.error(e),r(!1)}))}));return function(e,t){return r.apply(this,arguments)}}())}function x(){return x=A((function*(e){return new Promise(function(){var t=A((function*(t,r){let a=`/api/folders/${e}`;(0,f.getBackendSrv)().delete(a,{},{responseType:"text",showErrorAlert:!1}).then((e=>{t(!0)})).catch((e=>{console.error(e),t(!1)}))}));return function(e,r){return t.apply(this,arguments)}}())})),x.apply(this,arguments)}function T(e){return`alert-${e}-`}function q(){const e=f.config.buildInfo.version.split(".");if(e.length>0){if(11===parseInt(e[0],10))return!0}return!1}function D(e,t,r,a,o,n,i){try{var s=e[n](i),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(a,o)}function E(e){return function(){var t=this,r=arguments;return new Promise((function(a,o){var n=e.apply(t,r);function i(e){D(n,a,o,i,s,"next",e)}function s(e){D(n,a,o,i,s,"throw",e)}i(void 0)}))}}function I(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class O extends m.DataSourceApi{query(e){e.timezone?this.timezone="browser"===e.timezone?Intl.DateTimeFormat().resolvedOptions().timeZone:e.timezone:this.timezone=Intl.DateTimeFormat().resolvedOptions().timeZone;const t=e.targets.filter((e=>(!e.queryType||"SQL"===e.queryType)&&e.sql&&!(!0===e.hide)));return 0===t.length?Promise.all([]):Promise.all(t.map((t=>{let r=this.generateSql(t.sql,e);return this.lastGeneratedSql=r,this.request(r).then((r=>this.postQuery(t,r,e)))}))).then((t=>({data:this.arithmeticQueries(t,e).flat()})),(e=>{throw console.error(e),e.data&&e.data.desc?new Error(e.data.desc):new Error(e)}))}getAlertFolder(){return new Promise(((e,t)=>{let r=T(`${this.uid}`);this.backendSrv.get(`/api/folders/${r}`,{},"",{showErrorAlert:!1}).then((t=>{e(!0)})).catch((r=>{console.error(r),404===r.status?e(!1):t(r)}))}))}createAlertFolder(){return new Promise(((e,t)=>{let r={uid:T(`${this.uid}`),title:this.name+"-alert-"+this.folderUidSuffix};this.backendSrv.post("/api/folders",r).then((t=>{e(!0)})).catch((r=>{console.error(r),409===r.status?e(!0):t(r)}))}))}getAlerts(e){var t=this;return E((function*(){try{let r=`/api/v1/provisioning/folder/${T(`${t.uid}`)}/rule-groups/${e}`,a=yield t.backendSrv.get(r,{},"",{showErrorAlert:!1});return!!(a&&a.rules.length>0)}catch(e){if(404===e.status)return!1;throw console.error(e),e}}))()}loadAlerts(e,t){var r=this;return E((function*(){try{let a=`/api/v1/provisioning/folder/${T(`${r.uid}`)}/rule-groups/${e}`;return!!(yield r.backendSrv.put(a,t,{headers:{"X-Disable-Provenance":"true"}}))}catch(e){throw console.error(e),{status:"error",message:"Failed to load alarm rule directory, reason: "+e.message,title:"Failed"}}}))()}modifyAlertDataSource(e){e.folderUid=T(`${this.uid}`);let t=e.rules.length;for(let r=0;r<t;r++)e.rules[r].folderUID=e.folderUid,e.rules[r].data[0].datasourceUid=this.uid,e.rules[r].data[0].model.datasource.uid=this.uid}sendInitAlert(){var e=this;return new Promise(function(){var t=E((function*(t,r){try{if(q()){let t=yield e.getAlertFolder();t||(t=yield e.createAlertFolder()),t&&(t=yield e.getAlerts("alert_1m"),t||(e.modifyAlertDataSource(b.s7),yield e.loadAlerts("alert_1m",b.s7)),t=yield e.getAlerts("alert_5m"),t||(e.modifyAlertDataSource(b.op),yield e.loadAlerts("alert_5m",b.op)),t=yield e.getAlerts("alert_30s"),t||(e.modifyAlertDataSource(b.yB),yield e.loadAlerts("alert_30s",b.yB)),t=yield e.getAlerts("alert_90s"),t||(e.modifyAlertDataSource(b.AX),yield e.loadAlerts("alert_90s",b.AX)),t=yield e.getAlerts("alert_180s"),t||(e.modifyAlertDataSource(b.ez),yield e.loadAlerts("alert_180s",b.ez)),t=yield e.getAlerts("alert_24h"),t||(e.modifyAlertDataSource(b.uy),yield e.loadAlerts("alert_24h",b.uy)))}t()}catch(e){console.error(e),r(e)}}));return function(e,r){return t.apply(this,arguments)}}())}testDatasource(){return this.request("show databases").then((e=>e&&200===e.status&&!g().get(e,"data.code")?!0===this.isLoadAlerts?this.sendInitAlert().then((()=>({status:"success",message:"TDengine Data source is working",title:"Success"}))).catch((e=>({status:"error",message:"TDengine Data source is working, but alert rules load failed, reason:"+e.message,title:"Failed"}))):{status:"success",message:"TDengine Data source is working",title:"Success"}:{status:"error",message:"TDengine Data source is not working, reason: "+e.data.message,title:"Failed"}))}metricFindQuery(e,t){return this.request(this.generateSql(e,t)).then((e=>{var t;if(!(null==e||null===(t=e.data)||void 0===t?void 0:t.data))return[];const r=e.data.column_meta||[];let a=[];if(2===r.length&&("__text"===r[0][0]&&"__value"===r[1][0]||"__text"===r[1][0]&&"__value"===r[0][0])){let t=0,r=!1;"__text"===e.data.column_meta[1][0]&&(t=1);let o=e.data.column_meta[1-t][1].toUpperCase();"NCHAR"!==o&&"BINARY"!==o&&"VARCHAR"!==o||(r=!0);for(let o=0;o<e.data.data.length;o++){let n=""+e.data.data[o][t],i=e.data.data[o][1-t];r&&(i="'"+i+"'"),a.push({text:n,value:i})}}else for(let t=0;t<e.data.data.length;t++)a.push({text:""+e.data.data[t]});return(0,y.uniqBy)(a,"text")}))}getGenerateSql(){return this.lastGeneratedSql}request(e){return e?0===this.serverVersion?this.backendSrv.datasourceRequest({url:this.baseUrl+"/sql",data:"select server_version()",method:"POST"}).then((t=>t.data.data[0][0].startsWith("3")?(this.serverVersion=3,this.querySql(e)):(this.serverVersion=2,this.querySqlUtc(e)))).catch((e=>e)):3===this.serverVersion?this.querySql(e):this.querySqlUtc(e):new Promise(((e,t)=>{e()}))}querySql(e){return this.backendSrv.datasourceRequest({url:this.baseUrl+"/sql",data:e,method:"POST"}).then((e=>(e.data=this.convertResult(e.data),e))).catch((e=>{console.error("catch error: ",e)}))}querySqlUtc(e){return this.backendSrv.datasourceRequest({url:this.baseUrl+"/sqlutc",data:e,method:"POST"})}convertResult(e){let t={status:"",code:void 0,desc:void 0,column_meta:void 0,data:void 0,rows:0};return 0===e.code?(t.status="succ",t.column_meta=e.column_meta,t.column_meta.forEach((e=>{"TIMESTAMP"===e[1]&&(e[1]=9)})),t.data=e.data,t.rows=e.rows):(t.status="error",t.code=e.code,t.desc=e.desc),t}getRowAlias(e,t,r){if(!e)return Object.values(t)[0];return(e=this.generateSql(e,r)).replace(/\$(\w+)|\[\[([\s\S]+?)\]\]|\{\{([\s\S]+?)\}\}/g,((e,r,a,o)=>t[r||a||o]||e))}generateSql(e,t){if(!e||0===e.length)return e;let r="now-1h",a="now",o="20000";t&&(t.range&&t.range.from&&(r=t.range.from.toISOString()),t.range&&t.range.to&&(a=t.range.to.toISOString()),t.intervalMs&&(o=t.intervalMs.toString()),e=this.template.replace(e,t.scopedVars,"csv")),o+="a",e=e.replace(/^\s+|\s+$/gm,""),e=r.indexOf("now")<0?(e=e.replace(/\$from/g,"'"+r+"'")).replace(/\$begin/g,"'"+r+"'"):(e=e.replace(/\$from/g,r)).replace(/\$begin/g,r),e=(e=a.indexOf("now")<0?(e=e.replace(/\$to/g,"'"+a+"'")).replace(/\$end/g,"'"+a+"'"):(e=e.replace(/\$to/g,a)).replace(/\$end/g,a)).replace(/\$interval/g,o);const n=this.template.getVariables();for(const t of n)"current"in t&&t.current&&t.current.value&&(e=e.replace("$"+t.name,String(t.current.value)));return e}formatColumn(e,t){let r=e.match(/\{\{(\w+)\}\}/g);if(!r)return e;for(let a of r){let r=a.replaceAll("{{","");r=r.replaceAll("}}","");let o=t[r];o&&(e=e.replaceAll(a,o))}return e}long2wide(e,t,r){let a=e.data,o=e.column_meta;if(0===g().size(t))return e;let n=g()(o).map(((e,t)=>[e[0],t])).fromPairs().value();if(g().remove(t,(e=>!g().has(n,e))),0===g().size(t))return e;let[i,s]=g()(o).slice(1).partition((e=>g().includes(t,e[0]))).value(),l=[o[0]],u=g().map(s,((e,t)=>{let r=g()(i).map((e=>{let t=n[e[0]];return g()(a).map((e=>e[t])).uniq().map((t=>g().fromPairs([[e[0],t]]))).value()})).reduce(((e,t)=>g()(e).map((e=>g().map(t,(t=>g().extend({},e,t))))).flatten().value()));return{field:e,name:e[0],labels:r}})),c=g()(a).map((e=>e[0])).orderBy().uniq().value();return g().forEach(u,(e=>{let t=n[e.name];e.labels=g()(e.labels).map((e=>{let r=g()(a).filter((t=>g()(e).map(((e,r)=>t[n[r]]===e)).reduce(((e,t)=>e&&t)))).map((e=>[e[0],e[t]])).fromPairs().value();return g().size(r)>0?g().extend(e,{__values__:r}):null})).filter().value()})),g().forEach(u,(e=>{g().forEach(e.labels,(t=>{let a=g().cloneDeep(e.field),o=g()(t).keys().filter((e=>"__values__"!==e)).map((e=>[e,t[e]])).fromPairs().value();a[0]=r?this.formatColumn(r,o):e.name+" "+JSON.stringify(o),l.push(a)}))})),{data:g().map(c,(e=>{let t=[e];return g().forEach(u,(r=>{g().forEach(r.labels,(r=>{t.push(g().get(r.__values__,e))}))})),t})),column_meta:l,rows:g().size(c)}}groupDataByColName(e,t,r){if("Time series"===t.formatType&&"SQL"===t.queryType){let r=null;if(!t.colNameToGroup){let a=t.sql.match(/group +by +([^()\s,]+(,\s*\S+)*)\s*[^(,)]*$/);if(!a)return[e];r=a[1];let o=g()(r).split(",").map((e=>g().trim(e))).value();return g().size(o)>0?[this.long2wide(e,o,t.colNameFormatStr)]:[e]}if(r=g().trim(t.colNameToGroup),!r||0===t.colNameToGroup.length)return[e];let a=g()(r).split(",").map((e=>g().trim(e))).value();return g().size(a)>0?[this.long2wide(e,a,t.colNameFormatStr)]:[e]}if(!t.colNameToGroup||0===t.colNameToGroup.length)return[e];for(let a=0;a<e.column_meta.length;a++)if(e.column_meta[a][0]===t.colNameToGroup){let o={};const n=e.data,i=e.rows;for(let s=0;s<i;s++){let i=n[s][a];if(!o[i]){o[i]={column_meta:[],data:[],rows:0};for(let n=0;n<e.column_meta.length;n++)if(n!==a){let a=[...e.column_meta[n]];0===n&&9===a[1]||(a[0]=this.getRowAlias(t.colNameFormatStr||"prefix_{{group_field}}",{colName:a[0],groupValue:i},r)),o[i].column_meta.push(a)}}n[s].splice(a,1),o[i].data.push(n[s]),o[i].rows+=1}let s=Object.keys(o).sort(),l=[];for(let e=0;e<s.length;e++)l.push(o[s[e]]);return l}return[e]}postQuery(e,t,r){if(!t||!t.data||!t.data.data)return[];let a=this.groupDataByColName(t.data,e,r);const o=[],n=(e.alias||"").split(",")||[];let i=0;for(let t=0;t<a.length;t++){const s=a[t].column_meta,l=a[t].data,u=a[t].rows,c=s.length;if(s&&s[0]&&s[0][1]){const t=s.findIndex((e=>9===e[1]));if(-1===t||"Table"===e.formatType)o.push({columns:s.map((e=>({text:e[0]}))),rows:l,type:"table",refId:e.refId,target:this.getRowAlias(n[0],{col:s[0][0]},r),hide:!!e.hide});else for(let a=0;a<c;a++){if(a===t)continue;let c=s[a][0];i<n.length&&(c=this.getRowAlias(n[i],{col:c},r),i++);let d={datapoints:[],refId:e.refId,target:c,hide:!!e.hide};for(let r=0;r<u;r++){let o=_().duration();e.timeShiftPeriod&&e.timeShiftUnit&&(o=_().duration(e.timeShiftPeriod,e.timeShiftUnit)),d.datapoints.push([l[r][a],_().utc(l[r][t]).tz(this.timezone).add(o).valueOf()])}o.push(d)}}}return o}arithmeticQueries(e,t){const r=t.targets.filter((e=>"Arithmetic"===e.queryType&&e.expression&&!(!0===e.hide)));if(0===r.length)return e;let a=e.flatMap((e=>e.flatMap(((e,t)=>0===t?[e.refId,e.refId+"__"+t]:[e.refId+"__"+t])))),o={};e.forEach((e=>{e.forEach(((e,t)=>{e.datapoints.forEach((e=>{o[e[1]]=o[e[1]]||[],0===t&&o[e[1]].push(e[0]),o[e[1]].push(e[0])}))}))}));try{let n=r.map((e=>{let r=a.join(", "),n="return ("+e.expression+");",i=new Function(r,n),s=null;const l=(e.alias||"").split(",").map((r=>this.getRowAlias(r,{col:e.refId},t))),u=[];return Object.entries(o).forEach((t=>{if(t[1].length===a.length)try{s=i.apply(this,t[1])}catch(e){throw e}Array.isArray(s)||(s=[s]),s.forEach(((r,a)=>{u[a]=u[a]||{datapoints:[],refId:e.refId,target:l[a]||e.refId+"__"+a,hide:!!e.hide},u[a].datapoints.push([r,parseInt(t[0],10)])}))})),u}));return e.concat(n)}catch(e){throw new Error(e)}}generateTimeshift(e,t){let r=t.alias||"";return r=this.template.replace(r,e.scopedVars,"csv"),r}generateAlias(e,t){let r=t.alias||"";return r=this.template.replace(r,e.scopedVars,"csv"),r}constructor(e){super(e),I(this,"baseUrl",void 0),I(this,"backendSrv",void 0),I(this,"template",void 0),I(this,"timezone",""),I(this,"lastGeneratedSql",""),I(this,"serverVersion",0),I(this,"isLoadAlerts",void 0),I(this,"folderUidSuffix",void 0),this.baseUrl=e.url,this.backendSrv=(0,f.getBackendSrv)(),this.template=(0,f.getTemplateSrv)(),this.isLoadAlerts=e.jsonData.isLoadAlerts,this.folderUidSuffix=e.jsonData.folderUidSuffix}}var P=u(959),B=u.n(P),N=u(7);function j(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function k(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},a=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),a.forEach((function(t){j(e,t,r[t])}))}return e}function C(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function U(e,t){const{onOptionsChange:r,options:a}=e;return(0,P.useCallback)((e=>{var o,n;"url"===t&&(a.url=e.target.value),"user"===t&&(a.user=e.target.value,a.basicAuthUser=e.target.value),"user"===t&&(null===(o=a.secureJsonData)||void 0===o?void 0:o.password)&&(a.basicAuth=!0,a.secureJsonData.basicAuth=F(e.target.value+":"+a.secureJsonData.password)),"password"===t&&(null===(n=a.secureJsonData)||void 0===n?void 0:n.user)&&(a.basicAuth=!0,a.secureJsonData.basicAuth=F(a.secureJsonData.user+":"+e.target.value)),"password"===t&&a.secureJsonData&&(a.secureJsonData.basicAuthPassword=e.target.value),"token"===t&&a.secureJsonData&&(a.secureJsonData.token=e.target.value),r(C(k({},a),{secureJsonData:C(k({},a.secureJsonData),{[t]:e.target.value})}))}),[r,a,t])}function F(e){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let r,a,o,n,i,s,l,u="",c=0;for(;c<e.length;)r=e.charCodeAt(c++),a=e.charCodeAt(c++),o=e.charCodeAt(c++),n=r>>2,i=(3&r)<<4|a>>4,s=(15&a)<<2|o>>6,l=63&o,isNaN(a)?s=l=64:isNaN(o)&&(l=64),u=u+t.charAt(n)+t.charAt(i)+t.charAt(s)+t.charAt(l);return u}function R(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Q(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},a=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),a.forEach((function(t){R(e,t,r[t])}))}return e}function M(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function L(e,t){const{onOptionsChange:r,options:a}=e;return(0,P.useCallback)((()=>{r(M(Q({},a),{secureJsonFields:M(Q({},a.secureJsonFields),{[t]:!1}),secureJsonData:M(Q({},a.secureJsonData),{[t]:""})}))}),[r,a,t])}var z=u(292),G=u.n(z),$=u(893),V=u.n($),W=u(383),J=u.n(W),H=u(884),Y=u.n(H),K=u(88),X=u.n(K),Z=u(997),ee=u.n(Z),te=u(98),re={};re.styleTagTransform=ee(),re.setAttributes=Y(),re.insert=J().bind(null,"head"),re.domAPI=V(),re.insertStyleElement=X();G()(te.A,re);te.A&&te.A.locals&&te.A.locals;function ae(e,t,r,a,o,n,i){try{var s=e[n](i),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(a,o)}function oe(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ne(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},a=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),a.forEach((function(t){oe(e,t,r[t])}))}return e}function ie(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const{SecretFormField:se,FormField:le}=N.LegacyForms;function ue(e,t){return(0,P.useMemo)((()=>{if(e)return{label:null!=t?t:e,value:e}}),[t,e])}function ce(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function de(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function pe(e,t){const{onChange:r,onRunQuery:a,query:o}=e,{propertyName:n,runQuery:i}=t;return(0,P.useCallback)((e=>{(null==e?void 0:e.value)&&(r(de(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},a=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),a.forEach((function(t){ce(e,t,r[t])}))}return e}({},o),{[n]:e.value})),i&&a())}),[r,a,o,n,i])}function me(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function fe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},a=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),a.forEach((function(t){me(e,t,r[t])}))}return e}function ye(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function ge(e,t){const{onChange:r,onRunQuery:a,query:o}=e,{propertyName:n,runQuery:i}=t;return(0,P.useCallback)((e=>{e&&(r(ye(fe({},o),{[n]:e.target.value})),i&&a())}),[r,a,o,n,i])}function he(e,t){const{onChange:r,onRunQuery:a,query:o}=e,{propertyName:n,runQuery:i}=t;return(0,P.useCallback)((e=>{e&&(r(ye(fe({},o),{[n]:e.target.value})),i&&a())}),[r,a,o,n,i])}const _e=new m.DataSourcePlugin(O).setConfigEditor((function(e){const{secureJsonData:t}=e.options,{secureJsonFields:r}=e.options,a=U(e,"url"),o=L(e,"url"),n=U(e,"user"),i=L(e,"user"),s=U(e,"password"),l=L(e,"password"),u=U(e,"token"),c=L(e,"token"),[d,p]=B().useState(r&&r.token?"token":"basic");let m=!0;void 0===e.options.jsonData.isLoadAlerts?(e.options.jsonData.isLoadAlerts=!0,m=e.options.jsonData.isLoadAlerts):m=e.options.jsonData.isLoadAlerts,void 0===e.options.jsonData.folderUidSuffix&&(e.options.jsonData.folderUidSuffix=function(){const e=new Date;return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")} ${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}:${String(e.getSeconds()).padStart(2,"0")}`}());const[f,y]=B().useState(!1);(0,P.useEffect)((()=>{const e=function(){var e,t=(e=function*(){const e=yield q();y(e)},function(){var t=this,r=arguments;return new Promise((function(a,o){var n=e.apply(t,r);function i(e){ae(n,a,o,i,s,"next",e)}function s(e){ae(n,a,o,i,s,"throw",e)}i(void 0)}))});return function(){return t.apply(this,arguments)}}();e()}),[]);const[g,h]=B().useState(!1),[_,b]=B().useState(!1),[v,A]=B().useState(""),S=()=>{D(!1),h(!1),function(e){return w.apply(this,arguments)}(e.options.uid).then((()=>{})).catch((e=>{throw b(!0),A("Failed to delete alarm rules, reason: "+e.message),e}))},[x,T]=B().useState(m),D=t=>{T(t);const{onOptionsChange:r,options:a}=e;e.options.jsonData.isLoadAlerts=t,r(ie(ne({},a),{jsonData:ne({},a.jsonData)}))};return B().createElement("div",{className:"gf-form-group"},B().createElement(N.FieldSet,{label:"TDengine Host"},B().createElement("div",{className:"gf-form max-width-30"},B().createElement(le,{label:"Host",labelWidth:8,inputWidth:22,tooltip:"datasource's host",onChange:a,onBlur:a,onReset:o,value:e.options.url||"",placeholder:"http://localhost:6041",required:!0,disabled:e.options.readOnly}))),B().createElement(N.FieldSet,{label:"TDengine Authentication"},B().createElement(N.TabsBar,null,B().createElement(N.Tab,{label:"by user and password",active:"basic"===d,onChangeTab:()=>p("basic")}),B().createElement(N.Tab,{label:"by token",active:"token"===d,onChangeTab:()=>p("token")})),B().createElement(N.TabContent,null,"basic"===d&&B().createElement("div",null,B().createElement("div",{className:"gf-form max-width-20"},B().createElement(le,{label:"User",labelWidth:8,inputWidth:10,tooltip:"datasource's username",onChange:n,onBlur:n,onReset:i,value:e.options.user||"",disabled:e.options.readOnly,placeholder:r.basicAuth?"basic_auth configured":"username"})),B().createElement("div",{className:"gf-form max-width-20"},B().createElement(se,{isConfigured:r&&r.password,value:(null==t?void 0:t.password)||"",label:"Password",tooltip:"datasource's password",labelWidth:8,inputWidth:10,onReset:l,onChange:s,onBlur:s,disabled:e.options.readOnly||r&&r.password,placeholder:r.basicAuth?"basic_auth configured":"password"}))),"token"===d&&B().createElement("div",{className:"gf-form max-width-30"},B().createElement(se,{isConfigured:r&&r.token,value:(null==t?void 0:t.token)||"",label:"Token",tooltip:"datasource's cloud token",placeholder:"token of TDengine cloud",labelWidth:8,inputWidth:22,onReset:c,onChange:u,onBlur:u,disabled:e.options.readOnly||r&&r.token})))),B().createElement("div",null,f&&B().createElement(N.FieldSet,{label:"TDengine Alert"},B().createElement("div",{className:"gf-form max-width-20"},B().createElement(le,{label:"Load TDengine Alert",labelWidth:10,className:"align-center",inputEl:B().createElement(N.Switch,{onChange:e=>{D(e.target.checked)},value:x})})),B().createElement("div",{className:"gf-form max-width-20"},B().createElement(le,{label:"Clear TDengine Alert",labelWidth:10,className:"align-center",inputEl:B().createElement(N.Button,{variant:"destructive",onClick:()=>h(!0),title:"Clear the TDengine alerts",icon:"trash-alt",size:"sm"})})),B().createElement(N.ConfirmModal,{isOpen:g,title:"Clear TDengine Alerts",body:"Are you sure you want to clear alerts?",confirmText:"Cancel",dismissText:"Confirm",icon:"exclamation-triangle",onConfirm:()=>h(!1),onDismiss:()=>S()}),B().createElement(N.Modal,{isOpen:_,title:B().createElement("div",null,B().createElement(N.Icon,{name:"x",color:"red",size:"xxl"})," ",B().createElement("label",{style:{color:"red",fontSize:"16px"}},"Failed to delete rules")),onDismiss:()=>b(!1)},B().createElement("p",{style:{fontSize:"16px"}},v)))))})).setQueryEditor((function(e){const{query:t}=e;t.queryType||(t.queryType="SQL"),t.formatType||(t.formatType="Time series");const r=pe(e,{propertyName:"queryType",runQuery:!0}),a=ge(e,{propertyName:"alias",runQuery:!1}),o=ge(e,{propertyName:"alias",runQuery:!0}),n=he(e,{propertyName:"sql",runQuery:!1}),i=he(e,{propertyName:"sql",runQuery:!0}),s=ge(e,{propertyName:"timeShiftPeriod",runQuery:!1}),l=pe(e,{propertyName:"timeShiftUnit",runQuery:!1}),u=pe(e,{propertyName:"formatType",runQuery:!0}),c=ge(e,{propertyName:"colNameToGroup",runQuery:!1}),d=ge(e,{propertyName:"colNameToGroup",runQuery:!0}),p=ge(e,{propertyName:"colNameFormatStr",runQuery:!1}),m=ge(e,{propertyName:"colNameFormatStr",runQuery:!0}),f=()=>{const[t,r]=(0,P.useState)(!1);let a=e.datasource.getGenerateSql();return B().createElement(N.Collapse,{label:"Generate SQL",className:"gf-form-label width-10",collapsible:!0,isOpen:t,onToggle:()=>r(!t)},B().createElement("p",null,a))},y=()=>{const[e,t]=(0,P.useState)(!1);return B().createElement(N.Collapse,{label:"Show Help",className:"gf-form-label width-10",collapsible:!0,isOpen:e,onToggle:()=>t(!e)},B().createElement("p",{dangerouslySetInnerHTML:{__html:"Use any SQL that can return Resultset such as:</br>- [[timestamp1, value1], [timestamp2, value2], ... ]</br></br>Macros:</br>- $from -&gt; start timestamp of panel</br>- $to -&gt; stop timestamp of panel</br>- $interval -&gt; interval of panel</br></br>Example of SQL:</br>&nbsp;&nbsp;SELECT count(*)</br> FROM db.table WHERE ts > $from and ts < $to INTERVAL ($interval)"}}))},g=[{label:"SQL",value:"SQL"},{label:"Arithmetic",value:"Arithmetic"}],h=[{label:"Time series",value:"Time series"},{label:"Table",value:"Table"}];var _,b,v,A;return B().createElement("div",{className:"gf-form-group"},B().createElement(N.InlineFieldRow,null,B().createElement(N.InlineField,{id:"queryType",label:"Query Type",labelWidth:20},B().createElement(N.Select,{inputId:"queryType",width:20,options:g,defaultValue:g[0],onChange:r,value:ue(t.queryType)})),B().createElement(N.InlineField,{label:"Alias By",labelWidth:20},B().createElement(N.Input,{width:20,onChange:a,onBlur:o,value:null!==(_=t.alias)&&void 0!==_?_:"",placeholder:"Naming pattern: a,{{'{{'}}col}}"})),B().createElement("div",{className:"gf-form gf-form--grow"},B().createElement("div",{className:"gf-form-label gf-form-label--grow"}))),B().createElement(N.InlineFieldRow,null,B().createElement(N.InlineField,{label:"Input Sql",labelWidth:20,tooltip:"",grow:!0},B().createElement(N.TextArea,{style:{width:"100%",minWidth:"800px"},rows:5,className:"min-width-30 max-width-100 gf-form--grow",placeholder:"select _wstart as ts, avg(mem_free), dnode_ep from log.taosd_dnodes_info where _ts>=$from and _ts<=$to partition by dnode_ep interval($interval)",onChange:n,onBlur:i,value:t.sql}))),B().createElement(N.InlineFieldRow,null,B().createElement(f,null),B().createElement(y,null),B().createElement(N.InlineField,{id:"formatType",label:"Format new col",labelWidth:20},B().createElement(N.Select,{inputId:"formatType",width:20,options:h,defaultValue:h[0],onChange:u,value:ue(t.formatType)}))),B().createElement(N.InlineFieldRow,null,B().createElement(N.InlineField,{label:"Time Shift",labelWidth:20,tooltip:""},B().createElement(N.Input,{width:20,onChange:s,onBlur:s,value:null!==(b=t.timeShiftPeriod)&&void 0!==b?b:"",placeholder:"period number like: 1"})),B().createElement(N.InlineField,{label:"Time Shift Unit",labelWidth:20,tooltip:""},B().createElement(N.Select,{width:20,options:[{label:"seconds",value:"seconds"},{label:"minutes",value:"minutes"},{label:"hours",value:"hours"},{label:"days",value:"days"},{label:"weeks",value:"weeks"},{label:"months",value:"months"}],onChange:l,value:ue(t.timeShiftUnit)})),B().createElement("div",{className:"gf-form gf-form--grow"},B().createElement("div",{className:"gf-form-label gf-form-label--grow"}))),B().createElement(N.InlineFieldRow,null,B().createElement(N.InlineField,{label:"Group By Column(s)",labelWidth:20,tooltip:""},B().createElement(N.Input,{width:20,onChange:c,onBlur:d,value:null!==(v=t.colNameToGroup)&&void 0!==v?v:""})),B().createElement(N.InlineField,{label:"Group By Format",labelWidth:20,tooltip:""},B().createElement(N.Input,{width:20,onChange:p,onBlur:m,value:null!==(A=t.colNameFormatStr)&&void 0!==A?A:"",placeholder:"prefix_{{group_field}}_suffix"})),B().createElement("div",{className:"gf-form gf-form--grow"},B().createElement("div",{className:"gf-form-label gf-form-label--grow"}))))}));return c})()));
//# sourceMappingURL=module.js.map